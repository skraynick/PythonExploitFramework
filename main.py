import time

import click
import shodan
import pyfiglet
import tkinter as tk
from tkinter import ttk, Text, Label, Toplevel, Button
from tkinter.messagebox import showinfo
from functools import partial


class Main:
    root = tk.Tk()
    frame = tk.Frame(root)

    api_key = tk.StringVar()
    t = Text(root, height=2)


def get_shodan_api_key():
    top = Toplevel(Main.root)
    top.geometry("750x250")
    top.title("Enter your API key!")
    email_label = Label(top, text="Shodan Api Key:")
    email_label.pack(fill='x')

    email_entry = ttk.Entry(top, textvariable=Main.api_key)
    email_entry.pack()
    email_entry.focus()
    save_button = ttk.Button(top, text="Save", command=partial(save_api_key, top))
    save_button.pack()


def save_api_key(top):
    if len(Main.api_key.get()) > 0:
        msg = f'You entered: {Main.api_key.get()}'
        showinfo(
            title='Information',
            message=msg
        )
        top.destroy()
        Main.t.insert(tk.END, msg)




def request_page_from_shodan(query, page):
    l = Label(text="What is 24 * 5 ? ")
    inputtxt = Text(root, height=10,
                    width=25,
                    bg="light yellow")
    inputtxt.pack()
    l.pack()
    while True:
        try:
            instances = get_shodan_api_key().search(query, page=page)
            return instances
        except shodan.APIError as error:
            print(f'Error: {error}')
            time.sleep(5)


def main():
    Main.root.title('My Tool')
    Label(Main.root, text=" Click the Below Button to enter your Shodan API Key.", font='Helvetica 14 bold').pack()
    Button(Main.root, text="Enter API key!", command=get_shodan_api_key).pack()

    Main.t.pack()
    #result = pyfiglet.figlet_format("Python Exploit")
    #print(result)

    Main.root.geometry('600x400+50+50')
    Main.root.mainloop()


if __name__ == '__main__':
    main()
